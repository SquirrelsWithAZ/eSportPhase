<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
        <style>
            #dude {
                border-radius: 5px;
                background-color: cyan;
                width: 20px;
                height: 20px;
                position: absolute;
                z-index: 100;
            }
            #dudette {
                border-radius: 5px;
                background-color: lightgreen;
                width: 20px;
                height: 20px;
                position: absolute;
                z-index: 100;
            }
        </style>
    </head>
    <body>
        <div id="dude"></div>
        <div id="dudette"></div>
        <script type="text/javascript">
            $(function() {
                var CONST_SIZE = 20;
                var ROWS = 10;
                var COLS = 50;
                
                var grid = [];
            
                function placePerson($person, personData) {
                    $person.css("left", (CONST_SIZE + CONST_SIZE * personData.x) + "px");
                    $person.css("top", (CONST_SIZE + CONST_SIZE * personData.y) + "px");
                    $person.css("background-color", personData.color);
                }
                
                function movePerson(keyCode, $person, person) {
                    switch(keyCode) {
                        case "left":
                            person.x--;
                            break;
                        case "up":
                            person.y--;
                            break;
                        case "down":
                            person.y++;
                            break;
                        case "right":
                            person.x++;
                            break;
                        default:
                            return;
                    };
                    
                    placePerson($person, person);
                        
                    var $div = grid[person.y * COLS + person.x];
                    var data = $div.data("game");
                    
                    if(data.color === "red") {
                        for(var x = 0; x < COLS; x++) {
                            for(var y = 0; y < ROWS; y++) {
                                $div = grid[y * COLS + x];
                                data = $div.data("game");
                                if(data.color === "white") { data.color = "black"; }
                                else if(data.color === "black") { data.color = "white"; }
                                
                                $div.css("background-color", data.color);
                            }
                        }
                        
                        dude.color = (dude.color === "cyan") ? "navy" : "cyan";
                        dudette.color = (dudette.color === "lightgreen") ? "green" : "lightgreen";
                        placePerson($dude, dude);
                        placePerson($dudette, dudette);
                    }
                }
            
                function clickHandler() {
                    $this = $(this);
                    data = $this.data("game");

                    //data.color = (data.color === "black") ? "white" : "black";
                    if(data.color === "black") {
                        data.color = "white";
                    }
                    else if(data.color === "white") {
                        data.color = "red";
                    }
                    else {
                        data.color = "black";
                    }
                    
                    $this.css("background-color", data.color);
                }
            
                var $body = $("body");
                var $dude = $("#dude");
                var $dudette = $("#dudette");
        
                for(var x = 0; x < COLS; x++) {
                    for(var y = 0; y < ROWS; y++) {
                        var $div = grid[y * COLS + x] = $(document.createElement("DIV"));
                        $div
                            .css("background-color", "black")
                            .css("border", "1px dotted #eee")
                            .css("width", CONST_SIZE + "px")
                            .css("height", CONST_SIZE + "px")
                            .css("position", "absolute")
                            .css("left", (CONST_SIZE + x * CONST_SIZE) + "px")
                            .css("top", (CONST_SIZE + y * CONST_SIZE) + "px")
                            .data("game", { color: "black" })
                            .click(clickHandler)
                            ;
                            
                        $body.append($div);
                    }
                }
                
                var dude = { x: 0, y: 0, color: "cyan" };
                var dudette = { x: COLS - 1, y: ROWS - 1 };
                placePerson($dude, dude);
                placePerson($dudette, dudette);
                
                $body.keydown(function(e) {
                    var P1 = { 37: "left", 38: "up", 40: "down", 39: "right" };
                    var P2 = { 87: "up", 65: "left", 83: "down", 68: "right" };
                    
                    var dir = P1[e.keyCode];
                    if(dir !== undefined) { movePerson(dir, $dude, dude); }
                    
                    dir = P2[e.keyCode];
                    if(dir !== undefined) { movePerson(dir, $dudette, dudette); }
                });
            });
        </script>
    </body>
</html>